<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Training with CloudML • cloudml</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">CloudML for R</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">Home</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Guides
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/training.html">Training with CloudML</a>
    </li>
    <li>
      <a href="../articles/training.html">Deploying Models</a>
    </li>
    <li>
      <a href="../articles/tuning.html">Hyperparameter Tuning</a>
    </li>
    <li>
      <a href="../articles/storage.html">Google Cloud Storage</a>
    </li>
    <li>
      <a href="../articles/configuration.html">CloudML Configuration</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/rstudio/cloudml">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Training with CloudML</h1>
            
          </div>

    
    
<div class="contents">
<div id="cloudml-workflow" class="section level2">
<h2 class="hasAnchor">
<a href="#cloudml-workflow" class="anchor"></a>CloudML Workflow</h2>
<p>The basic steps described above are the essential components of working with CloudML. That said, there are many flexible options available for managing jobs, viewing results, and specifying the compute resources required for training. This section describes this functionality in more detail.</p>
<div id="local-development" class="section level3">
<h3 class="hasAnchor">
<a href="#local-development" class="anchor"></a>Local Development</h3>
<p>Working on a CloudML project always begins with developing a training script that runs on your local machine. This will typically involve using some combination of the <a href="https://keras.rstudio.com/">keras</a>, <a href="https://tensorflow.rstudio.com/tfestimators">tfestimators</a>, and <a href="https://tensorflow.rstudio.com/">tensorflow</a> packages. Once your script is working the way you expect you are ready to submit it to CloudML.</p>
</div>
<div id="training-jobs" class="section level3">
<h3 class="hasAnchor">
<a href="#training-jobs" class="anchor"></a>Training Jobs</h3>
<p>The core unit of work in CloudML is a job. A job consists of a training script and related files (e.g. other scripts, data files, ec.). To submit a job to CloudML you use the <code><a href="../reference/cloudml_train.html">cloudml_train()</a></code> function, passing it the name of the training script to run. For example:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">job &lt;-<span class="st"> </span><span class="kw"><a href="../reference/cloudml_train.html">cloudml_train</a></span>(<span class="st">"minst_mlp.R"</span>)</code></pre></div>
<div class="bs-callout bs-callout-warning">
<p>Note that the CloudML training and job management functions described here all work relative to the current working directory of your R session, so you should always switch to the working directory containing your scripts before executing these functions.</p>
</div>
<p>The <code><a href="../reference/cloudml_train.html">cloudml_train()</a></code> function returns a <code>job</code> object. This is a reference to the training job which you can use later to check it’s status, collect it’s output, etc. For example:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/job_status.html">job_status</a></span>(job)</code></pre></div>
<pre><code> $ createTime    : chr "2017-12-18T20:35:21Z"
 $ etag          : chr "2KRqIbAhzvM="
 $ jobId         : chr "cloudml_2017_12_18_203510175"
 $ startTime     : chr "2017-12-18T20:35:52Z"
 $ state         : chr "RUNNING"
 $ trainingInput :List of 3
  ..$ jobDir        : chr "gs://cedar-card-791/r-cloudml/staging"
  ..$ region        : chr "us-east1"
  ..$ runtimeVersion: chr "1.4"
 $ trainingOutput:List of 1
  ..$ consumedMLUnits: num 0.04

View job in the Cloud Console at:
https://console.cloud.google.com/ml/jobs/cloudml_2017_12_18_203510175?project=cedar-card-791

View logs at:
https://console.cloud.google.com/logs?resource=ml.googleapis.com%2Fjob_id%2Fcloudml_2017_12_18_203510175&amp;project=cedar-card-791</code></pre>
<p>You can call <code><a href="../reference/job_collect.html">job_collect()</a></code> at any time to download the job:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/job_collect.html">job_collect</a></span>(job)</code></pre></div>
<p>If it hasn’t already completed, R will block waiting for the job to complete and then perform the download. After the job has downloaded a report showing the results of the job will be automatically displayed.</p>
<p>To interact with jobs you don’t need the <code>job</code> object returned from <code><a href="../reference/cloudml_train.html">cloudml_train()</a></code>. If you call <code><a href="../reference/job_status.html">job_status()</a></code> or <code><a href="../reference/job_collect.html">job_collect()</a></code> with no arguments they will act on the most recently submitted job:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/job_status.html">job_status</a></span>()   <span class="co"># get status of last job</span>
<span class="kw"><a href="../reference/job_collect.html">job_collect</a></span>()  <span class="co"># collect last job</span></code></pre></div>
<p>You can also list jobs and then reference them by job ID:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/job_list.html">job_list</a></span>()</code></pre></div>
<pre><code>                        JOB_ID    STATUS             CREATED
1 cloudml_2017_12_18_203510175 SUCCEEDED 2017-12-18 15:35:21
2 cloudml_2017_12_18_202228264    FAILED 2017-12-18 15:22:39
3 cloudml_2017_12_18_201607948 SUCCEEDED 2017-12-18 15:16:18
4 cloudml_2017_12_18_132620918 SUCCEEDED 2017-12-18 08:26:30
5 cloudml_2017_12_15_182614794 SUCCEEDED 2017-12-15 13:26:29
6 cloudml_2017_12_14_183247626 SUCCEEDED 2017-12-14 13:33:04</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/job_collect.html">job_collect</a></span>(<span class="st">"cloudml_2017_12_18_203510175"</span>)</code></pre></div>
</div>
<div id="training-runs" class="section level3">
<h3 class="hasAnchor">
<a href="#training-runs" class="anchor"></a>Training Runs</h3>
<p>Each training job will produce one or more training runs (it’s typically only a single run, however when doing hyperparmeter turning there will be multiple runs). When you collect a job from CloudML it is automatically downloaded into the <code>runs</code> sub-directory of the current working directory.</p>
<p>You can list all of the runs as a data frame using the <code>ls_runs()</code> function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ls_runs</span>()</code></pre></div>
<pre><code># A tibble: 6 x 34
                            run_dir metric_loss metric_acc metric_val_loss metric_val_acc
                              &lt;chr&gt;       &lt;dbl&gt;      &lt;dbl&gt;           &lt;dbl&gt;          &lt;dbl&gt;
1 runs/cloudml_2017_12_15_182614794      0.0809     0.9763          0.0889         0.9786
2 runs/cloudml_2017_12_14_183247626      0.0806     0.9770          0.0919         0.9773
3 runs/cloudml_2017_12_14_144048138      0.0786     0.9772          0.0896         0.9777
4 runs/cloudml_2017_12_14_143427111      0.0803     0.9771          0.0940         0.9760
5 runs/cloudml_2017_12_14_124739611      0.0829     0.9766          0.0913         0.9782
6 runs/cloudml_2017_12_14_124625505      0.0805     0.9765          0.0981         0.9766
# ... with 29 more variables: flag_dropout1 &lt;dbl&gt;, flag_dropout2 &lt;dbl&gt;, samples &lt;int&gt;,
#   validation_samples &lt;int&gt;, batch_size &lt;int&gt;, epochs &lt;int&gt;, epochs_completed &lt;int&gt;,
#   metrics &lt;chr&gt;, model &lt;chr&gt;, loss_function &lt;chr&gt;, optimizer &lt;chr&gt;, learning_rate &lt;dbl&gt;,
#   script &lt;chr&gt;, start &lt;dttm&gt;, end &lt;dttm&gt;, completed &lt;lgl&gt;, output &lt;chr&gt;, source_code &lt;chr&gt;,
#   context &lt;chr&gt;, type &lt;chr&gt;, cloudml_console_url &lt;chr&gt;, cloudml_created &lt;dttm&gt;,
#   cloudml_end &lt;dttm&gt;, cloudml_job &lt;chr&gt;, cloudml_log_url &lt;chr&gt;, cloudml_ml_units &lt;dbl&gt;,
#   cloudml_scale_tier &lt;chr&gt;, cloudml_start &lt;dttm&gt;, cloudml_state &lt;chr&gt;</code></pre>
<p>You can view run reports using the <code>view_run()</code> function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># view the latest run</span>
<span class="kw">view_run</span>()

<span class="co"># view a specific run</span>
<span class="kw">view_run</span>(<span class="st">"runs/cloudml_2017_12_15_182614794"</span>)</code></pre></div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#cloudml-workflow">CloudML Workflow</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Javier Luraschi, JJ Allaire, Kevin Ushey.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
