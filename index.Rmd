---
title: "R Interface to CloudML"
output: 
  rmarkdown::html_vignette: 
    readme: true
vignette: >
  %\VignetteIndexEntry{Getting Started}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, eval=FALSE)
```

[![Build Status](https://travis-ci.org/rstudio/cloudml.svg?branch=master)](https://travis-ci.org/rstudio/cloudml) [![CRAN_Status_Badge](https://www.r-pkg.org/badges/version/cloudml)](https://cran.r-project.org/package=cloudml)

# R Interface to Google CloudML

![](images/cloudml.png){align=right width=200px style="margin-left: 10px;"}

The **cloudml** package provides an R interface to [Google Cloud Machine Learning Engine](https://cloud.google.com/ml-engine/), a managed service that enables:

* Scalable training of models built with the [keras](https://keras.rstudio.com/), [tfestimators](https://tensorflow.rstudio.com/tfestimators), and [tensorflow](https://tensorflow.rstudio.com/) R packages.

* On-demand access to training on GPUs, including the new [Tesla P100 GPUs](http://www.nvidia.com/object/tesla-p100.html) from NVIDIA&reg;. 

* Hyperparameter tuning to optmize key attributes of model architectures in order to maximize predictive accuracy.

* Deployment of trained models to the Google global prediction platform that can support thousands of users and TBs of data.

<div style="height: 25px;"></div>

## Getting Started

### Google Cloud Account

Before you can begin training models with CloudML you need to have a *Google Cloud Account*. If you don't already have an account you can create one at <https://console.cloud.google.com>.

### Installation

Start by installing the cloudml R package from GitHub as follows:

```r
devtools::install_github("rstudio/cloudml")
```

Then, install the *Google Cloud SDK*, a set of utilties that enable you to interact with your Google Cloud account from within R. You can install the SDK using the `gcloud_install()` function. 

```{r}
library(cloudml)
gcloud_install()
```

Note that in order to ensure that the **cloudml** package can find your installation of the SDK you should accept the default installation location (`~/`) suggested within the installer.

Once you've completed these steps you are ready to train models with CloudML!

### Training on CloudML

To train a model on CloudML, first work the training script locally (perhaps with a smaller sample of your dataset). The script can contain arbitrary R code which trains and/or evaluates a model. Once you've confirmed that things work as expected, you can submit a CloudML job to perform training in the cloud.

#### Submitting a Job

To submit a job, call the `cloudml_train()` function, specifying the R script to execute for training:

```{r}
library(cloudml)
cloudml_train("train.R")
```

All of the files within the current working directory will be bundled up and sent along with the script to CloudML.

If you are using [RStudio v1.1](https://www.rstudio.com/products/rstudio/download/) or higher, then the CloudML training job is monitored (and it's results collected) using a background terminal:

![](images/rstudio-terminal.png){.screenshot width=730px}

#### Collecting Results

When the job is complete, training results can be collected back to your local system (this is done automatically when monitoring the job using a background terminal in RStudio). A run report is displayed after the job is collected:

![](images/training-run.png){.screenshot width=730px}

Artifacts of your training run (e.g. saved models) are downloaded along with various run metrics and saved to the `runs` sub-directory of the working directory from which you submitted your training job.

### Training with a GPU

By default, CloudML utilizes CPU based instances for training. You can request the use of a GPU using the `scale_tier` parameter of `cloudml_train()`. For example, the following would train the same model as above but with a GPU:

```{r}
cloudml_train("train.R", scale_tier = "basic-gpu")
```

Note that GPU instances are more expensive that CPU ones! See the documentation on [CloudML Pricing](https://cloud.google.com/ml-engine/pricing) for additional information.

## Learning More

To learn more about using CloudML with R, see the following guides:

* [Training with CloudML](articles/training.html) goes into additional depth on managing training jobs and their output.

* [Deploying Models](articles/training.html) describes how to deploy trained models and generate predictions from them.

* [Hyperparameter Tuning](articles/tuning.html) explores how you can improve the performance of your models by running many trials with distinct hyperparameters (e.g. number and size of layers) to determine their optimal values.

* [Google Cloud Storage](articles/storage.html) provides information on copying data between your local machine and Google Storage and also describes how to use data within Google Storage during training.

* [CloudML Configuration](articles/configuration.html) covers available configuration options, including how to use various Google Cloud account profiles and customize the compute instances used for training.






